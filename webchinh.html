<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ThriftC | HaiHand c≈© nh∆∞ng ch·∫•t</title>
  <link rel="stylesheet" href="webchinh.css" />
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
<header>
  <div class="nav">
    <div class="logo"><a href="webchinh.html">ThriftC</a></div>
    <div class="hamburger" id="hamburger">‚ò∞</div>
    <nav class="nav-links" id="nav-links">
      <a href="#products">S·∫£n ph·∫©m</a>
      <a href="orders.html">L·ªãch s·ª≠ ƒë∆°n h√†ng</a>
      <a href="#contact">Li√™n h·ªá</a>
    </nav>
    <div class="nav-right">
      <span class="nav-user" id="nav-user"></span>
      <a href="dangnhap.html" class="nav-link-auth" id="login-link">ƒêƒÉng nh·∫≠p</a>
      <a href="dangky.html" class="nav-link-auth nav-link-auth-primary" id="register-link">ƒêƒÉng k√Ω</a>
      <button id="logout-btn" class="nav-link-auth nav-link-auth-primary" style="display:none;">ƒêƒÉng xu·∫•t</button>

      <!-- Menu kh√°ch h√†ng + h·ªó tr·ª£ -->
      <div class="account-menu" id="account-menu">
        <span class="account-menu-icon">üë§</span>
        <div class="account-dropdown" id="account-dropdown">
          <button type="button" onclick="openCustomerModal()">Th√¥ng tin kh√°ch h√†ng</button>
          <button type="button" onclick="openSupportModal()">H·ªó tr·ª£</button>
        </div>
      </div>

      <!-- Gi·ªè h√†ng -->
      <div class="cart" id="cart">
        üõí <span>Gi·ªè</span>
        <span class="cart-count" id="cart-count">0</span>
        <div class="cart-dropdown" id="cart-dropdown">
          <div class="cart-items" id="cart-items"></div>
          <div class="cart-total">
            <span>T·ªïng:</span>
            <strong id="cart-total">0‚Ç´</strong>
          </div>
          <button type="button" class="btn-primary btn-cart-checkout" onclick="openCartPayment()">
            Thanh to√°n
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="hero fade-in">
    <h1>HaiHand c≈© nh∆∞ng ch·∫•t</h1>
    <p>L√©t g√¥ - Mua ƒë√™ b·ªù r√¥</p>
    <!-- N√∫t hero c√≥ r·ªìng SVG -->
    <button class="btn-primary dragon-btn" onclick="scrollToProducts()">
      <span class="dragon-label">Kh√°m ph√° ngay</span>
      <svg class="dragon-svg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 32C18 20 30 18 40 22C48 25 54 32 56 40C50 38 44 38 40 40C34 43 30 48 28 56C24 50 20 46 14 44C10 42 8 38 8 32Z"
              fill="none" stroke="#eab308" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M36 20C38 18 40 16 42 14" stroke="#b91c1c" stroke-width="2.2" stroke-linecap="round"/>
        <circle cx="44" cy="18" r="2" fill="#fefce8"/>
      </svg>
    </button>
  </section>

  <section id="products" class="products-section fade-in">
    <h2>S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
    <p class="products-sub">M·ªói m√≥n m·ªôt chi·∫øc ‚Äì kh√¥ng c√≥ hai.</p>

    <div class="filter-search-row">
      <div class="filter-bar">
        <select id="filterSelect" onchange="applyFilters()">
          <option value="all">T·∫•t c·∫£</option>
          <option value="ao">√Åo</option>
          <option value="quan">Qu·∫ßn</option>
          <option value="hoodie">Hoodie</option>
          <option value="jacket">Jacket</option>
        </select>
      </div>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="T√¨m: Karakuri, Sukajan, Evisu, Bape..." oninput="applyFilters()">
      </div>
    </div>

    <div class="product-grid" id="product-grid"></div>
  </section>

  <section id="contact" class="fade-in contact-section">
    <h2>Li√™n h·ªá</h2>
    <p>
      Instagram: <strong>@yu.lov_</strong><br>
      Facebook: <strong>Nguyen Cuong</strong><br>
      Hotline: 0325 813 890
    </p>
  </section>
</main>

<!-- Modal Th√¥ng tin kh√°ch h√†ng -->
<div class="modal" id="customer-modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeCustomerModal()">√ó</span>
    <h2>Th√¥ng tin kh√°ch h√†ng</h2>
    <p class="modal-note">Th√¥ng tin n√†y ƒë∆∞·ª£c d√πng ƒë·ªÉ giao h√†ng v√† li√™n h·ªá khi c·∫ßn thi·∫øt.</p>
    <input type="text" id="cus-name" placeholder="H·ªç v√† t√™n">
    <input type="text" id="cus-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
    <input type="text" id="cus-email" placeholder="Email (@gmail.com)">
    <input type="text" id="cus-address" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng">
    <button class="btn-primary" onclick="saveCustomerInfo()">L∆∞u th√¥ng tin</button>
  </div>
</div>

<!-- Modal H·ªó tr·ª£ -->
<div class="modal" id="support-modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeSupportModal()">√ó</span>
    <h2>H·ªó tr·ª£ ThriftC</h2>
    <p class="modal-note">
      N·∫øu c·∫ßn h·ªó tr·ª£ th√™m, b·∫°n c√≥ th·ªÉ li√™n h·ªá:
      <br>Instagram: @yu.lov_
      <br>Facebook: Nguyen Cuong
      <br>Hotline: 0325 813 890
    </p>
  </div>
</div>

<!-- Modal Thanh to√°n (d√πng chung cho gi·ªè h√†ng) -->
<div class="modal" id="payment-modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closePaymentModal()">√ó</span>
    <h2>Thanh to√°n ƒë∆°n h√†ng</h2>
    <div id="payment-summary"></div>
    <p class="modal-note">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n:</p>

    <div class="payment-options">
      <label class="pay-option">
        <input type="radio" name="payment-method" value="Thanh to√°n khi nh·∫≠n" checked>
        <div class="pay-option-main">
          <div class="pay-option-header-row">
            <div class="pay-option-title">üíµ Thanh to√°n khi nh·∫≠n</div>
            <span class="pay-option-badge">Khuy√™n d√πng</span>
          </div>
          <div class="pay-option-desc">Tr·∫£ ti·ªÅn tr·ª±c ti·∫øp cho shipper khi nh·∫≠n h√†ng.</div>
        </div>
      </label>

      <label class="pay-option">
        <input type="radio" name="payment-method" value="Momo">
        <div class="pay-option-main">
          <div class="pay-option-title">üí∞ V√≠ Momo</div>
          <div class="pay-option-desc">Thanh to√°n nhanh b·∫±ng v√≠ Momo.</div>
        </div>
      </label>

      <label class="pay-option">
        <input type="radio" name="payment-method" value="ATM n·ªôi ƒë·ªãa">
        <div class="pay-option-main">
          <div class="pay-option-title">üí≥ ATM n·ªôi ƒë·ªãa</div>
          <div class="pay-option-desc">Chuy·ªÉn kho·∫£n qua th·∫ª ng√¢n h√†ng n·ªôi ƒë·ªãa.</div>
        </div>
      </label>

      <label class="pay-option">
        <input type="radio" name="payment-method" value="Visa / MasterCard">
        <div class="pay-option-main">
          <div class="pay-option-title">üí≥ Visa / MasterCard</div>
          <div class="pay-option-desc">Th·∫ª t√≠n d·ª•ng / ghi n·ª£ qu·ªëc t·∫ø.</div>
        </div>
      </label>
    </div>

    <!-- H∆∞·ªõng d·∫´n chi ti·∫øt theo t·ª´ng ph∆∞∆°ng th·ª©c -->
    <div id="payment-extra" style="margin-top:6px;"></div>

    <button id="payment-confirm-btn" class="btn-primary" onclick="confirmPayment()">
      X√°c nh·∫≠n thanh to√°n
    </button>
  </div>
</div>

<!-- TOAST TH√îNG B√ÅO -->
<div id="toast" class="toast" style="display:none;"></div>

<footer>
  <p>¬© 2025 ThriftC ¬∑ 2hand c≈© nh∆∞ng ch·∫•t.</p>
</footer>

<script src="products.js"></script>
<script src="thriftc.js"></script>
<script>
const products = ThriftC.products;

// Render s·∫£n ph·∫©m
function renderProducts(list){
  const grid=document.getElementById('product-grid');
  grid.innerHTML='';
  if(list.length===0){
    grid.innerHTML='<p class="products-sub">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p.</p>';
    return;
  }
  list.forEach(p=>{
    grid.innerHTML+=`
      <div class="product-card">
        <img src="${p.img}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p class="price">${ThriftC.formatPrice(p.price)}</p>
        <div class="product-btns">
          <button onclick="addToCart(${p.id})" class="btn-add dragon-btn">
            <span class="dragon-label">Th√™m gi·ªè</span>
            ${window.ThriftC && ThriftC.dragonSVG ? ThriftC.dragonSVG : ""}
          </button>
          <a href="webttqao.html?id=${p.id}" class="btn-buy dragon-btn">
            <span class="dragon-label">Chi ti·∫øt</span>
            ${window.ThriftC && ThriftC.dragonSVG ? ThriftC.dragonSVG : ""}
          </a>
        </div>
      </div>`;
  });
}

function applyFilters(){
  const filterVal=document.getElementById('filterSelect').value;
  const keyword=document.getElementById('searchInput').value.trim().toLowerCase();
  let list=[...products];
  if(filterVal!=="all") list=list.filter(p=>p.type===filterVal);
  if(keyword){
    list=list.filter(p=>p.name.toLowerCase().includes(keyword));
  }
  renderProducts(list);
}

// Toast helper
function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.display = 'block';
  t.classList.remove('hide');
  t.classList.add('show');
  setTimeout(()=> {
    t.classList.remove('show');
    t.classList.add('hide');
    setTimeout(()=>{ t.style.display='none'; }, 200);
  }, 2000);
}

// Gi·ªè h√†ng
function addToCart(id){
  const res = ThriftC.addToCart(id);
  if(!res.added && res.reason==='exists'){
    showToast('S·∫£n ph·∫©m n√†y ƒë√£ c√≥ trong gi·ªè üêâ');
  } else if(res.added) {
    showToast('ƒê√£ th√™m v√†o gi·ªè h√†ng! üêâ');
  }
  updateCartUI();
}
function removeItem(id){
  ThriftC.removeFromCart(id);
  updateCartUI();
  showToast('ƒê√£ xo√° s·∫£n ph·∫©m kh·ªèi gi·ªè.');
}
function updateCartUI(){
  const cart=ThriftC.getCart();
  const count=document.getElementById('cart-count');
  const items=document.getElementById('cart-items');
  const total=document.getElementById('cart-total');
  let sum=0;
  items.innerHTML='';
  cart.forEach(i=>{
    sum+=i.price*i.qty;
    items.innerHTML+=`
      <div class="cart-item">
        <img src="${i.img}">
        <div style="flex:1">
          <p>${i.name}</p>
          <small>${i.qty} x ${ThriftC.formatPrice(i.price)}</small>
        </div>
        <button class="btn-remove" onclick="removeItem(${i.id})">‚ùå</button>
      </div>`;
  });
  count.textContent=cart.reduce((a,b)=>a+b.qty,0);
  total.textContent=ThriftC.formatPrice(sum);
}

// User UI
function updateUserUI(){
  const user=ThriftC.getCurrentUser();
  const navUser=document.getElementById('nav-user');
  const loginLink=document.getElementById('login-link');
  const registerLink=document.getElementById('register-link');
  const logoutBtn=document.getElementById('logout-btn');
  if(user){
    navUser.textContent="Xin ch√†o, "+user.name;
    loginLink.style.display='none';
    registerLink.style.display='none';
    logoutBtn.style.display='inline-block';
  }else{
    navUser.textContent="";
    loginLink.style.display='inline-block';
    registerLink.style.display='inline-block';
    logoutBtn.style.display='none';
  }
}
document.getElementById('logout-btn').addEventListener('click',()=>{
  ThriftC.logout();
  updateUserUI();
  updateCartUI();
  showToast('ƒê√£ ƒëƒÉng xu·∫•t t√†i kho·∫£n.');
});

// Hamburger menu
document.getElementById('hamburger').addEventListener('click',()=>{
  document.getElementById('nav-links').classList.toggle('open');
});

// Dropdown gi·ªè h√†ng
const cartElem = document.getElementById('cart');
const dropdown = document.getElementById('cart-dropdown');
function showDropdown(){ dropdown.classList.add('visible'); }
function hideDropdownIfOut(){
  setTimeout(()=>{
    if(!cartElem.matches(':hover') && !dropdown.matches(':hover')){
      dropdown.classList.remove('visible');
    }
  },120);
}
cartElem.addEventListener('mouseenter',showDropdown);
cartElem.addEventListener('mouseleave',hideDropdownIfOut);
dropdown.addEventListener('mouseenter',showDropdown);
dropdown.addEventListener('mouseleave',hideDropdownIfOut);

// Menu account
const accMenu = document.getElementById('account-menu');
const accDropdown = document.getElementById('account-dropdown');
accMenu.addEventListener('click',()=>{
  accDropdown.classList.toggle('visible');
});

// ====== TH√îNG TIN KH√ÅCH H√ÄNG ======
function openCustomerModal(){
  const user = ThriftC.getCurrentUser();
  if(!user){
    showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi c·∫≠p nh·∫≠t th√¥ng tin kh√°ch h√†ng.');
    location.href='dangnhap.html';
    return;
  }
  const info = ThriftC.getCustomerInfo() || { name: user.name || '', email: user.email || '', phone: '', address: '' };
  document.getElementById('cus-name').value = info.name || '';
  document.getElementById('cus-phone').value = info.phone || '';
  document.getElementById('cus-email').value = info.email || user.email;
  document.getElementById('cus-address').value = info.address || '';
  document.getElementById('customer-modal').style.display='flex';
}
function closeCustomerModal(){
  document.getElementById('customer-modal').style.display='none';
}

function saveCustomerInfo(){
  const name = document.getElementById('cus-name').value.trim();
  const phone = document.getElementById('cus-phone').value.trim();
  const email = document.getElementById('cus-email').value.trim();
  const address = document.getElementById('cus-address').value.trim();

  if(!ThriftC.validators.isValidName(name)){
    showToast('H·ªç t√™n ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ (kh√¥ng s·ªë, kh√¥ng k√Ω hi·ªáu).');
    return;
  }
  if(!ThriftC.validators.isValidPhone(phone)){
    showToast('S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (9-11 ch·ªØ s·ªë).');
    return;
  }
  if(!ThriftC.validators.isValidEmail(email)){
    showToast('Email ph·∫£i c√≥ d·∫°ng ...@gmail.com.');
    return;
  }
  if(!address){
    showToast('Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng.');
    return;
  }

  const ok = ThriftC.saveCustomerInfo({ name, phone, email, address });
  if(!ok){
    showToast('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi l∆∞u th√¥ng tin kh√°ch h√†ng.');
    return;
  }
  showToast('ƒê√£ l∆∞u th√¥ng tin kh√°ch h√†ng.');
  closeCustomerModal();
}

// H·ªó tr·ª£
function openSupportModal(){
  document.getElementById('support-modal').style.display='flex';
}
function closeSupportModal(){
  document.getElementById('support-modal').style.display='none';
}

// ====== ƒêI·ªÄU KI·ªÜN THANH TO√ÅN + POPUP THANH TO√ÅN ======
function ensureUserReady(){
  const user = ThriftC.getCurrentUser();
  if(!user){
    showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi thanh to√°n.');
    setTimeout(()=>{ location.href='dangnhap.html'; },800);
    return false;
  }
  const info = ThriftC.getCustomerInfo();
  if(!ThriftC.isCustomerInfoComplete(info)){
    showToast('Vui l√≤ng c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß "Th√¥ng tin kh√°ch h√†ng" tr∆∞·ªõc khi thanh to√°n.');
    return false;
  }
  return true;
}

let currentPurchase = [];
const paymentProcessState = {
  method: 'Thanh to√°n khi nh·∫≠n',
  step: 'select'   // select -> confirm
};

function openCartPayment(){
  if(!ensureUserReady()) return;
  const cart = ThriftC.getCart();
  if(cart.length === 0){
    showToast('Gi·ªè h√†ng tr·ªëng.');
    return;
  }
  currentPurchase = cart;

  // render t√≥m t·∫Øt v√†o modal
  let html = '';
  let total = 0;
  cart.forEach(i=>{
    const sub = i.price * i.qty;
    total += sub;
    html += `
      <div class="cart-item">
        <img src="${i.img}">
        <div>
          <p>${i.name}</p>
          <small>${i.qty} x ${ThriftC.formatPrice(i.price)}</small>
        </div>
      </div>`;
  });
  html += `
    <hr>
    <div class="cart-total">
      <span>T·ªïng:</span>
      <strong>${ThriftC.formatPrice(total)}</strong>
    </div>`;
  document.getElementById('payment-summary').innerHTML = html;

  // reset state khi m·ªü
  paymentProcessState.step = 'select';
  const btn = document.getElementById('payment-confirm-btn');
  if(btn) btn.textContent = 'X√°c nh·∫≠n thanh to√°n';

  openPaymentModal();
  updatePaymentExtra(); // c·∫≠p nh·∫≠t h∆∞·ªõng d·∫´n theo ph∆∞∆°ng th·ª©c ƒëang ch·ªçn
}

function openPaymentModal(){
  document.getElementById('payment-modal').style.display = 'flex';
}
function closePaymentModal(){
  document.getElementById('payment-modal').style.display = 'none';
  paymentProcessState.step = 'select';
}

// H∆∞·ªõng d·∫´n c·ª• th·ªÉ cho t·ª´ng ph∆∞∆°ng th·ª©c
function updatePaymentExtra(){
  const selected = document.querySelector('input[name="payment-method"]:checked');
  const extra = document.getElementById('payment-extra');
  if(!selected || !extra) return;
  const method = selected.value;
  paymentProcessState.method = method;
  paymentProcessState.step = 'select'; // khi ƒë·ªïi ph∆∞∆°ng th·ª©c th√¨ reset v·ªÅ b∆∞·ªõc 1

  if(method === 'Momo'){
    extra.style.display = 'block';
    extra.innerHTML = `
      <h4 style="margin:0 0 6px; color:#eab308; font-size:1rem;">Thanh to√°n b·∫±ng Momo</h4>
      <p style="margin:2px 0; font-size:0.85rem; color:#e5e7eb;">
        Qu√©t m√£ QR d∆∞·ªõi ƒë√¢y b·∫±ng ·ª©ng d·ª•ng Momo v√† nh·∫≠p <strong>ƒë√∫ng t·ªïng ti·ªÅn</strong> hi·ªÉn th·ªã trong ƒë∆°n.
      </p>
      <!-- L∆∞u ·∫£nh QR Momo c·ªßa b·∫°n v√†o th∆∞ m·ª•c img/ v√† ch·ªânh l·∫°i ƒë∆∞·ªùng d·∫´n n·∫øu c·∫ßn -->
      <img src="img/momo-qr-nguyen-manh-cuong.png"
           alt="QR Momo"
           style="display:block;margin:6px auto 4px;width:170px;height:170px;border-radius:12px;border:1px solid rgba(234,179,8,0.4);object-fit:cover;">
      <p style="margin:2px 0; font-size:0.8rem; color:#9ca3af;">
        Sau khi ho√†n t·∫•t giao d·ªãch tr√™n Momo, vui l√≤ng b·∫•m n√∫t <strong>ƒê√£ thanh to√°n</strong> ƒë·ªÉ x√°c nh·∫≠n ƒë∆°n h√†ng.
      </p>
    `;
  } else if(method === 'ATM n·ªôi ƒë·ªãa'){
    extra.style.display = 'block';
    extra.innerHTML = `
      <h4 style="margin:0 0 6px; color:#eab308; font-size:1rem;">Thanh to√°n b·∫±ng th·∫ª ATM n·ªôi ƒë·ªãa</h4>
      <p style="margin:2px 0; font-size:0.85rem; color:#e5e7eb;">
        Vui l√≤ng chuy·ªÉn kho·∫£n ƒë·∫øn t√†i kho·∫£n sau:
      </p>
      <p style="margin:2px 0; font-size:0.85rem;">
        <strong>Ng√¢n h√†ng:</strong> ABC Bank<br>
        <strong>S·ªë t√†i kho·∫£n:</strong> 1234 5678 999<br>
        <strong>Ch·ªß t√†i kho·∫£n:</strong> NGUY·ªÑN M·∫†NH C∆Ø·ªúNG<br>
        <strong>N·ªôi dung:</strong> THRIFTC - SƒêT c·ªßa b·∫°n
      </p>
      <p style="margin:2px 0; font-size:0.8rem; color:#9ca3af;">
        Sau khi chuy·ªÉn kho·∫£n th√†nh c√¥ng, b·∫•m <strong>ƒê√£ thanh to√°n</strong> ƒë·ªÉ ho√†n t·∫•t ƒë∆°n h√†ng.
      </p>
    `;
  } else if(method === 'Visa / MasterCard'){
    extra.style.display = 'block';
    extra.innerHTML = `
      <h4 style="margin:0 0 6px; color:#eab308; font-size:1rem;">Thanh to√°n b·∫±ng Visa / MasterCard</h4>
      <p style="margin:2px 0; font-size:0.85rem; color:#e5e7eb;">
        K√™nh thanh to√°n qua th·∫ª qu·ªëc t·∫ø ƒëang ƒë∆∞·ª£c tri·ªÉn khai.
      </p>
      <p style="margin:2px 0; font-size:0.85rem;">
        Trong th·ªùi gian n√†y, b·∫°n vui l√≤ng ch·ªçn <strong>Thanh to√°n khi nh·∫≠n</strong> ho·∫∑c chuy·ªÉn kho·∫£n qua
        <strong>Momo / ATM n·ªôi ƒë·ªãa</strong> ƒë·ªÉ x·ª≠ l√Ω ƒë∆°n h√†ng nhanh h∆°n.
      </p>
    `;
  } else {
    // Thanh to√°n khi nh·∫≠n
    extra.style.display = 'none';
    extra.innerHTML = '';
  }

  const btn = document.getElementById('payment-confirm-btn');
  if(btn) btn.textContent = 'X√°c nh·∫≠n thanh to√°n';
}

function confirmPayment(){
  if(!ensureUserReady()) return;
  if(currentPurchase.length === 0){
    showToast('Gi·ªè h√†ng tr·ªëng.');
    closePaymentModal();
    return;
  }
  const selected = document.querySelector('input[name="payment-method"]:checked');
  if(!selected){
    showToast('Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n.');
    return;
  }
  const method = selected.value;
  const info = ThriftC.getCustomerInfo();
  const total = currentPurchase.reduce((s,i)=>s+i.price*i.qty,0);

  // COD: t·∫°o ƒë∆°n lu√¥n
  if(method === 'Thanh to√°n khi nh·∫≠n'){
    const order = {
      id: Date.now(),
      date: new Date().toLocaleString('vi-VN'),
      items: currentPurchase,
      total,
      payment: method,
      customer: info,
      status: 'ƒêang x·ª≠ l√Ω'
    };
    ThriftC.saveOrder(order);
    ThriftC.clearCart();
    currentPurchase = [];
    updateCartUI();
    closePaymentModal();
    showToast('ƒê·∫∑t h√†ng th√†nh c√¥ng! Ki·ªÉm tra L·ªãch s·ª≠ ƒë∆°n h√†ng nh√©.');
    return;
  }

  // C√°c ph∆∞∆°ng th·ª©c chuy·ªÉn kho·∫£n: 2 b∆∞·ªõc
  if(paymentProcessState.step === 'select'){
    paymentProcessState.step = 'confirm';
    const btn = document.getElementById('payment-confirm-btn');
    if(btn) btn.textContent = 'ƒê√£ thanh to√°n - Ho√†n t·∫•t ƒë∆°n';
    showToast(`Vui l√≤ng thanh to√°n qua ${method}, sau ƒë√≥ b·∫•m "ƒê√£ thanh to√°n - Ho√†n t·∫•t ƒë∆°n".`);
    return;
  }

  // B∆∞·ªõc x√°c nh·∫≠n cu·ªëi
  const order = {
    id: Date.now(),
    date: new Date().toLocaleString('vi-VN'),
    items: currentPurchase,
    total,
    payment: method,
    customer: info,
    status: 'ƒêang x·ª≠ l√Ω'
  };

  ThriftC.saveOrder(order);
  ThriftC.clearCart();
  currentPurchase = [];
  updateCartUI();
  closePaymentModal();
  paymentProcessState.step = 'select';
  showToast('ƒê·∫∑t h√†ng th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ thanh to√°n.');
}

// G·∫Øn event cho radio thanh to√°n
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('input[name="payment-method"]').forEach(r => {
    r.addEventListener('change', updatePaymentExtra);
  });
  updatePaymentExtra();
});

// Kh√°c
function scrollToProducts(){
  document.getElementById('products').scrollIntoView({behavior:'smooth'});
}

// Init
applyFilters();
updateCartUI();
updateUserUI();
</script>
</body>
</html>
